IF (BUILD_TESTING)

  # vtkMy is tested using cmaketest.
  # We need a cmaketest that supports CMAKE_ARGS and
  # a FIND_PROGRAM that understand NO_SYSTEM_PATH.

  SET (VTKMY_CAN_BE_TESTED 0)
  IF (CMAKE_MAJOR_VERSION MATCHES [1-9][0-9]*)
    IF (CMAKE_MINOR_VERSION MATCHES [3-9][0-9]*)
      SET (VTKMY_CAN_BE_TESTED 1)
    ENDIF (CMAKE_MINOR_VERSION MATCHES [3-9][0-9]*)
  ENDIF (CMAKE_MAJOR_VERSION MATCHES [1-9][0-9]*)

  IF (VTKMY_CAN_BE_TESTED)

    GET_FILENAME_COMPONENT (CMAKE_PATH ${CMAKE_COMMAND} PATH)

    FIND_PROGRAM (CMAKETEST_COMMAND
      NAMES cmaketest
      PATHS ${CMAKE_PATH}
      NO_SYSTEM_PATH
    )

    MARK_AS_ADVANCED (
      CMAKETEST_COMMAND
    )

    IF (CMAKETEST_COMMAND)

      ADD_TEST (vtkMy
        ${CMAKETEST_COMMAND}
        ${VTK_SOURCE_DIR}/Examples/Build/vtkMy
        ${VTK_BINARY_DIR}/Examples/Build/vtkMy
        vtkmyEx1
        ${VTK_EXECUTABLE_PATH}
        vtkMy
        CMAKE_ARGS
        -DVTK_BINARY_PATH:PATH=${VTK_BINARY_DIR}
        -DUSE_BUILT_VTK:BOOL=1
        -DUSE_INSTALLED_VTK:BOOL=0
        -DBUILD_SHARED_LIBS:BOOL=OFF
        -DVTKMY_WRAP_PYTHON:BOOL=OFF
        -DVTKMY_WRAP_JAVA:BOOL=OFF
        -DUSE_VTK_OUTPUT_PATHS:BOOL=ON
      )

    ENDIF (CMAKETEST_COMMAND)

  ENDIF (VTKMY_CAN_BE_TESTED)

ENDIF (BUILD_TESTING)
